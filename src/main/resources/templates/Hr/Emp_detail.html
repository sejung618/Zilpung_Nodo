<!DOCTYPE html>
<html layout:decorate="~{layout}">


<div layout:fragment="content" class="container my-3">

	<div class="card">
		<div class="card-header bg-primary text-center">
			<h2 class="text-white">사원 정보</h2>
			<div id="alertMessage" style="display:none;"></div>
		</div>
		<div class="card-body">
			<div class="row">
				<div class="col-md-4">
					<img src="/img/undraw_profile_1.svg" alt="사원 사진" class="img-fluid">
				</div>
				<div class="col-md-8">
					<ul class="list-group list-group-flush">
						<li class="list-group-item"><strong>이름:</strong> <span th:text="${empDtail.empname}"></span>
						</li>
						<li class="list-group-item"><strong>사번:</strong> <span th:text="${empDtail.empnum}"></span></li>
						<li class="list-group-item"><strong>주소:</strong> <span th:text="${empDtail.empadd}"></span></li>
						<li class="list-group-item"><strong>전화번호:</strong> <span th:text="${empDtail.empphone}"></span>
						</li>
						<li class="list-group-item"><strong>이메일:</strong> <span th:text="${empDtail.empmail}"></span>
						</li>
						<li class="list-group-item"><strong>입사일:</strong> <span th:text="${empDtail.empdate}"></span>
						</li>
						<li class="list-group-item"><strong>부서:</strong>
							<span th:text="${empDtail.depart != null ? empDtail.depart.depname : '부서 정보 없음'}"></span>
						</li>
						<li class="list-group-item"><strong>직책:</strong> <span
								th:text="${empDtail.position != null ? empDtail.position.positionname : '직책 정보 없음'}"></span>
						</li>
						<li class="list-group-item"><strong>직위:</strong> <span
								th:text="${empDtail.spot != null ? empDtail.spot.spotname : '직위 정보 없음'}"></span>
						</li>
						<li class="list-group-item"><strong>직위:</strong> <span th:text="${errMessage}"></span>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!--		sec:authorize="isAuthenticated()"
			th:if="${empDtail.id != null and #authentication.principal.Empid == empDtail.id or #authentication.principal.Position > 1}">-->
		<div class="my-3">
			<a th:href="@{|/Hr/modify/${empDtail.id}|}" class="btn btn-primary ml-4" th:text="수정"></a>

			<a th:href="@{|/Hr/pass/${empDtail.id}|}" class="btn btn-primary" th:text="비밀번호변경"></a>

			<a href="javascript:void(0);" th:data-uri="@{|/Hr/delete/${empDtail.id}|}"
				class="delete btn btn-sm btn-outline-secondary" th:text="삭제"></a>
			<!--<a th:href="@{|/Hr/delete/${empDtail.id}|}" 
				class="delete btn btn-sm btn-outline-secondary" th:text="삭제"></a>
				th:if="${empDtail.id != null and  #authentication.principal.Empid == 1}"-->

		</div>
	</div>

	<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">권한 없음</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">
					<a> errorMessage </a>
				</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-dismiss="modal">확인</button>

				</div>
			</div>
		</div>
	</div>
</div>


<script layout:fragment="script" type='text/javascript'>
	const delete_elements = document.getElementsByClassName("delete");
	Array.from(delete_elements).forEach(function (element) {
		element.addEventListener('click', function () {
			console.log(this.getAttribute("data-uri"));
			if (confirm("정말로 삭제하시겠습니까?")) {
				delEmp(this.getAttribute("data-uri").split("/").pop());  // /맨뒤부분 추출
			};
		});
	});

	function openModal(errorMessage) {
		var modal = document.getElementById("Modal");
		var modalBody = modal.querySelector(".modal-body");
		modalBody.innerHTML = "<a>" + errorMessage + "</a>";
		$(modal).modal("show");
	}
	function delEmp(id) {
		$.ajax({
			type: 'GET',
			url: '/Hr/delete/' + id,
			success: function (data) {
				// 성공 시 동작
				window.location.href = '/Hr/list';
			},
			error: function (xhr, status, error) {
				// 실패 시 동작
				var errorMessage = xhr.responseText;
				openModal(errorMessage);
			}
		});
	}
</script>
<!--
const delete_elements = document.getElementsByClassName("delete");
Array.from(delete_elements).forEach(function (element) {
    element.addEventListener('click', function (event) {
        event.preventDefault(); // 링크의 기본 동작인 페이지 이동을 막음
        const url = this.getAttribute("href"); // 삭제 요청을 보낼 URL 가져오기
        $.ajax({
            type: 'GET',
            url: url,
            success: function(data) {
                // 성공 시 동작 (선택사항)
                // 예를 들어, 삭제 후 어떤 동작을 수행하거나 알림을 표시할 수 있습니다.
                alert("삭제되었습니다.");
                window.location.reload(); // 페이지 새로고침 (선택사항)
            },
            error: function(xhr, status, error) {
                // 실패 시 동작
                var errorMessage = xhr.responseText;
                alert(errorMessage);
            }
        });
    });
});
-->

</html>